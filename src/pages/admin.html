<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin | Library Book Store</title>
    <link
      rel="shortcut icon"
      href="../assents/icons/book.svg"
      type="image/x-icon"
    />

    <!--Bootstrap Link-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!--Font Awesome-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!--Toastr Plugin Css-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css"
    />
    <link rel="stylesheet" href="../styles/general/global.css" />
    <link rel="stylesheet" href="../styles/pages/admin.css" />
    <link rel="stylesheet" href="../styles/response/adminResponse.css" />
    <!--Circle Progress Plugin Css-->
    <link rel="stylesheet" href="../styles/general/jquery.shCircleLoader.css">

  </head>

  <body>
    <main>
      <!--section -1-->

      <section id="section-1">
        <div id="section-logo">
          <img src="../assents/images/logo-group.svg" alt="" id="logoPicture" />
        </div>

        <div id="section-form">
          <h2 id="form-Name">Welcome Admin</h2>

          <div id="form-input">
            <input type="email" placeholder="Username" id="userName" />
            <input type="password" placeholder="Password" id="password" />
            <button id="btn">Join</button>
          </div>
        </div>
      </section>

      <!--For Responsive-->
      <section id="section-top">
        <div class="d-flex justify-content-around align-items-center">
          <div id="logo-responsive">
            <img src="../assents/icons/logo-color.svg" alt="" />
          </div>
          <div
            id="hamburger"
            id="hamburger"
            data-bs-toggle="modal"
            data-bs-target="#exampleModal"
          >
            <img src="../assents/icons/hambuger.svg" alt="" />
          </div>
        </div>
        <!--Modal-->
        <div
          class="modal fade"
          id="exampleModal"
          tabindex="-1"
          aria-labelledby="exampleModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header" id="bgColor">
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body" id="bgColor">
                <div>
                  <div id="image">
                    <img src="../assents/images/logo-group.svg" alt="" />
                  </div>
                  <div id="pages">
                    <img
                      src="../assents/icons/book.svg"
                      alt=""
                      id="page-image"
                    />
                    <a id="'test" href="#home">Home</a>
                  </div>
                  <div id="pages">
                    <img
                      src="../assents/icons/book.svg"
                      alt=""
                      id="page-image"
                    />
                    <a href="#about">About</a>
                  </div>
                  <div id="pages">
                    <img
                      src="../assents/icons/book.svg"
                      alt=""
                      id="page-image"
                    />
                    <a href="#Join">Join us</a>
                  </div>
                  <div id="pages">
                    <img
                      src="../assents/icons/book.svg"
                      alt=""
                      id="page-image"
                    />
                    <a href="#contact">Contact</a>
                  </div>
                  <div id="pages">
                    <img
                      src="../assents/icons/book.svg"
                      alt=""
                      id="page-image"
                    />
                    <a id="logout">Logout </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!--section -2-->

      <section id="section-2" style="display: none">
        <div id="left-section">
          <div id="image">
            <img src="../assents/images/logo-group.svg" alt="" />
          </div>
          <div id="pages">
            <img src="../assents/icons/book.svg" alt="" id="page-image" />
            <a href="#home">Home</a>
          </div>
          <div id="pages">
            <img src="../assents/icons/book.svg" alt="" id="page-image" />
            <a href="#about">About</a>
          </div>
          <div id="pages">
            <img src="../assents/icons/book.svg" alt="" id="page-image" />
            <a href="#Join">Join us</a>
          </div>
          <div id="pages">
            <img src="../assents/icons/book.svg" alt="" id="page-image" />
            <a href="#contact">Contact</a>
          </div>
          <div id="pages">
            <img src="../assents/icons/book.svg" alt="" id="page-image" />
            <a id="logout">Logout</a>
          </div>
        </div>
        <div id="main-section">
          <h2 id="bookheader">Add Book</h2>
          <label for="bookName" id="search-book">Search book</label> <br />
          <div class="main-section-1" id="home">
            <div id="input">
              <input type="text" id="bookName" placeholder="Dan Brown" />
              <span id="span-img"
                ><img src="../assents/icons/search.svg" alt=""
              /></span>
            </div>
            <div class="search-informations">
              <div class="example"></div>
              <!-- <div class="search-information">
                <img src="../assents/icons/oclock1.svg" alt="" />
                <span>Dan Brown Davinc</span>
              </div>
              <div class="search-information">
                <img src="../assents/icons/oclock2.svg" alt="" />
                <span>Dan Brown Davinc</span>
              </div> -->
            </div>
          </div>

          <div id="form-section-1" class="w-100">
            <h3 id="about-store-title">Book form</h3>
            <form action="" id="form-1">
              <label for="Angels" class="form-label mt-2">Book Name</label>
              <br />
              <input
                id="Angels"
                type="text"
                class="form-control"
                placeholder="Angels"
                aria-label="Angels"
                aria-describedby="addon-wrapping"
              />
              <br />
              <label for="Dan Brown" class="form-label mt-2">Author Name</label>
              <br />
              <input
                type="text"
                id="authorName"
                class="form-control"
                placeholder="Dan Brown"
                aria-label="Dan Brown"
                aria-describedby="addon-wrapping"
              />
              <br />
              <label for="Job" class="form-label mt-2">Book Image Url</label>
              <br />
              <input
                id="BookImageUrl"
                type="text"
                class="form-control"
                placeholder="Alex Smith"
                aria-label="BookImageUrl"
                aria-describedby="addon-wrapping"
              />
              <br />
              <div class="mb-3">
                <label for="textArea" class="form-label">Description</label>
                <textarea
                  class="form-control description-1"
                  id="textArea"
                  rows="3"
                  placeholder="We work without holidays and weekends! Resident...We work without holidays and weekends! Resident...We work without holidays and weekends! Resident..."
                ></textarea>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input me-1"
                  type="checkbox"
                  value=""
                  id="flexCheckDefault"
                />
                <label
                  class="form-check-label mt-1 mb-3"
                  for="flexCheckDefault"
                >
                  New
                </label>
              </div>
              <div id="typeofBook">
                <div id="left">
                  <span class="me-2">Book type</span>
                  <button type="button" class="btn btn-primary" id="addBook">Add</button>              
                  </div>
                <div id="right">
                  <input
                  type="text"
                  class="form-control me-2"
                  placeholder="Add Book"
                  aria-label="BookImageUrl"
                  aria-describedby="addon-wrapping"
                  id="BooktypeText"
                />  
                <div class="d-flex mb-4">
                    <button type="button" class="btn btn-success me-2" id="save">Add</button>                      
                    
                    </button>
                    <button type="button" class="btn btn-danger " id="cancel">Cancel</button>
                  </div>
                </div>
              </div>

              <br />
              <select class="form-select" aria-label="Default select example" id="selectForm">
                <option selected>Fantastic</option>
              </select>
              <br />
              <button type="button" class="btn mt-2 w-100 p-3" id="submit">
                Add
              </button>
            </form>
          </div>
          <div id="about" class="w-100 form-section-2 mb-5">
            <h3 id="about-store-title">About Store</h3>
            <form action="" id="form-2">
              <label for="AboutStore" class="form-label mt-2">Title</label>
              <br />
              <input
                id="AboutStore"
                type="text"
                class="form-control"
                placeholder="About Store"
                aria-label="About Store"
                aria-describedby="addon-wrapping"
              />
              <br />
              <label for="BookImageUrl1" class="form-label mt-2"
                >Book Image Url</label
              >
              <br />
              <input
                id="BookImageUrl1"
                type="text"
                class="form-control"
                placeholder="https://image:url/"
                aria-label="BookImageUrl"
                aria-describedby="addon-wrapping"
              />
              <br />

              <div class="mb-3">
                <label for="textArea1" class="form-label">Description</label>
                <textarea
                  class="form-control"
                  id="textArea1"
                  rows="3"
                  placeholder="We work without holidays and weekends! Resident...We work without holidays and weekends! Resident...We work without holidays and weekends! Resident..."
                ></textarea>
              </div>
              <button type="button" class="btn mt-2 w-100 p-3" id="submit1">
                Add
              </button>
            </form>
          </div>
          <div id="Join" class="table-section-1 mb-4">
            <h4 class="mb-3" id="table-name">Join Us</h4>
            <table class="table table-hover w-50">
              <thead id="thead">
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Full Name</th>
                  <th scope="col">Email Address</th>
                  <th scope="col">Clear</th>
                </tr>
              </thead>
              <tbody id="JoinTbody">
                <!--<tr>
                <th scope="row">4</th>
                <td>Victoria Lane</td>
                <td>deanna.curtis@example.com</td>
              </tr> -->
              </tbody>
            </table>
          </div>
          <h4 class="h3 mt-5 mb-2" id="contact">Contact Us</h4>

          <div id="table-section-2" class="w-100 mb-5">
            <table class="table">
              <thead id="thead">
                <tr>
                  <th scope="col">#</th>
                  <th scope="col" id="theadFullName">Full Name</th>
                  <th scope="col">Address</th>
                  <th scope="col">Email Address</th>
                  <th scope="col" id="theadPhone">Phone Number</th>
                  <th scope="col">Note</th>
                  <th scope="col">Clear</th>
                </tr>
              </thead>
              <tbody id="tbody">
                <!-- <tr id="tr">
                  <th scope="row">2</th>
                  <td>Savannah Howard</td>
                  <td id="adress">8445 Railroad St undefined Tampa</td>
                  <td>jeff.brown@example.com</td>
                  <td id="phoneNumber">(201) 555-0124</td>
                  <td id="text">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Fugit fuga, consequatur architecto aut, accusantium
                    voluptate inventore id unde, cupiditate quae officiis culpa.
                    Architecto voluptas, error repellendus enim odit dolores,
                    voluptates reiciendis dolore quia, voluptate culpa. Commodi
                    cupiditate quas vitae iusto optio deserunt a, modi
                    aspernatur suscipit. Praesentium neque ad sed.
                  </td>
                  <td id="delete">
                    <i
                      class="fa-solid fa-trash w-100 h-100"
                      style="color: brown; font-size: 36px"
                    ></i>
                  </td>
                </tr> -->
              </tbody>
            </table>
          </div>
        </div>
        <div id="right-section">
          <img src="../assents/icons/human.svg" alt="" />
          <span>Admin</span>
        </div>
      </section>

    </main>
    <!--bootstrap JS-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
      integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!--Plugin -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="../js/CircleProgressPlugins/jquery.shCircleLoader-min.js"></script>
    <script src="../js/CircleProgressPlugins/jquery.shCircleLoader.js"></script>

    <script src="../js/firebaseJs/db.js"></script>
    <script src="../js/admin.js"></script>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        onValue,
        remove,
        push,
        get
       
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);
      const Mybody = document.querySelector("body");
      const email = document.querySelector("#userName");
      const password = document.querySelector("#password");
      const btn = document.querySelector("#btn");
      const sectionForm = document.querySelector("#section-form");
      const section1 = document.querySelector("#section-1");
      const section2 = document.querySelector("#section-2");
      const sectionTop = document.querySelector("#section-top");
      const leftSection = document.querySelector("#left-section");
      const rightSection = document.querySelector("#right-section");
      const hamburger = document.querySelector("#hamburger");

      const bodyPx = Mybody.clientWidth;
      // const logoutButton = document.getElementById("logout");

      $(document).ready(function () {
        toastr.options = {
          closeButton: false,
          debug: false,
          newestOnTop: false,
          progressBar: false,
          positionClass: "toast-top-right",
          preventDuplicates: false,
          onclick: null,
          showDuration: "300",
          hideDuration: "1000",
          timeOut: "1000",
          extendedTimeOut: "1000",
          showEasing: "swing",
          hideEasing: "linear",
          showMethod: "fadeIn",
          hideMethod: "fadeOut",
        };
      });

      const userSignIn = async () => {
        const signInEmail = email.value;
        const signInPassword = password.value;
        signInWithEmailAndPassword(auth, signInEmail, signInPassword)
          .then((userCredential) => {
            const user = userCredential.user;
            // Msg.success('success message', timeout);
            toastr.success("You have signed in successfully!");
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            toastr.warning("Please fill the blank area!");
          });
      };

      const checkAuthState = async () => {
        onAuthStateChanged(auth, (user) => {
          if (user) {
            setTimeout(() => {
              document.querySelector("body").style.background = "white";
              section1.style.display = "none";
              section2.style.display = " block";
              section2.style.display = " flex";

              if (bodyPx <= 480) {
                sectionTop.style.display = " block";
                leftSection.style.display = "none";
                rightSection.style.display = "none";
              }
            }, 1500);
          }
        });
      };

      const userSignOut = async () => {
        await signOut(auth);
        setTimeout(() => {
          window.location.reload();
        }, 1500);
        toastr.warning("You have logged out!");
      };

      $(document).ready(function () {
        $(document).on("click", "#logout", userSignOut);
      });

      checkAuthState();

      btn.addEventListener("click", userSignIn);

      function showAlert(type, message) {
        /*
                <div class="alert alert-danger" role="alert">
                  A simple danger alert—check it out!
                </div>
      */
        let styles = {
          display: "block",
          position: "absolute",
          bottom: "15px",
          width: "90%",
          height: "45px",
        };
        let alert = document.createElement("div");
        alert.className = `alert alert-${type}  role ="alert" myAlert`;
        alert.textContent = message;
        Object.assign(alert.style, styles);
        //console.log(alert);
        sectionForm.appendChild(alert);

        setTimeout(function () {
          alert.remove();
        }, 2000);
      }

      // Contact Task Get All Data From Firebase
      onValue(ref(database, "contact"), getPersonals);
      function getPersonals(snapshot) {
        const data = convertDataObj(snapshot.val());
        console.log(data);
        document.querySelector("#tbody").innerHTML = data.map((person) => {
          return `

            <tr id="tr">
                  <th scope="row">1</th>
                  <td scope="col">${person.fullName}</td>
                  <td id="adress">${person.address}</td>
                  <td>${person.email}</td>
                  <td id="phoneNumber">${person.phoneNumber}</td>
                  <td id="text">${person.note} </td>
                  <td id="delete"   >
                    <i
                    data-value = ${person.id}
                      class="fa-solid fa-trash delete"
                      style="color: brown; font-size: 24px"
                     
                    ></i>
                  </td>
                </tr>
  `;
        });
      }

// Remove
function removePerson(id){
    
    const userRef = ref(database, "contact/"+id); // remove 
    const joinRef  =  ref(database, "join/"+id); // remove 
    remove(userRef)
   }
   $(document).ready(function(){
  $(document).on("click",".delete",function(){
    const el = $(this).data().value
    console.log(el)
    removePerson(el)
  })
})

// Join Task  
onValue(ref(database, "join"), getJoinPerson);

function getJoinPerson(snapshot){
  const data = convertDataObj(snapshot.val());
  console.log(data)
document.querySelector("#JoinTbody").innerHTML = data.map(joinPerson=>{

  return     `
  <tr>
    <th scope="row">1</th>

                <td>${joinPerson.ModalfullName}</td>
                <td>${joinPerson.Modalemail}</td>
                <td id="deleteJoin"   >
                    <i
                    data-value = ${joinPerson.id}
                      class="fa-solid fa-trash deleteJoin"
                      style="color: brown; font-size: 18px"
                     
                    ></i>
                  </td>
              </tr> 
  `
})

function removeJoinPerson(id){
    
    const userRef  =  ref(database, "join/"+id); // remove 
    remove(userRef)
   }
$(document).ready(function(){
  $(document).on("click",".deleteJoin",function(){
    const element = $(this).data().value
    removeJoinPerson(element)
  })
})


}
//  Push  bookBranch
document.querySelector("#submit").addEventListener("click",function(){
  const database = getDatabase(app);
 const userRef = ref(database, "bookData/"); 
const bookName = document.querySelector("#Angels").value.trim()
const authorName = document.querySelector("#authorName").value.trim()
const BookImageUrl = document.querySelector("#BookImageUrl").value.trim()
const selectOption = document.querySelector(".optionName").value
const checkList = document.querySelector("#flexCheckDefault").checked
if (!bookName || !authorName ||!BookImageUrl || !selectOption  ) {
            toastr.warning('Please Fill in the Field!');
           return
          }

          const BookdataInformation = {
            bookName,
            authorName,
            BookImageUrl,
            selectOption,
            checkList
          };
          toastr.success('Data has been successfully added to the database!');
          push(userRef, BookdataInformation);

          document.querySelector("#Angels").value=""
          document.querySelector("#authorName").value=""
          document.querySelector("#BookImageUrl").value=""
      

})
// get
get(ref(database,"bookData")).then((snapshot)=>{
  if(snapshot.exists()){
    const data = convertDataObj(snapshot.val());

   // console.log("data",data)

document.querySelector("#selectForm").innerHTML = data.map(option =>{
  return `
  <option >${option.selectOption}</option>

  ` })
  }
})
 

// Push aboutStore
 document.querySelector("#submit1").addEventListener("click",function(){
  const database = getDatabase(app);
 const userRef = ref(database, "aboutStore/"); 

  const AboutTitle = document.querySelector("#AboutStore").value
 const imgUrl = document.querySelector("#BookImageUrl1").value
 const descr = document.querySelector("#textArea1").value
if(!AboutTitle ||!imgUrl ||!descr){
  toastr.warning('Please Fill in the Field!');
           return


}
  const aboutdataInformaition = {
    AboutTitle,
    imgUrl,
    descr,
          };


          toastr.success('Data has been successfully added to the database!');

          push(userRef, aboutdataInformaition);
          document.querySelector("#AboutStore").value =""
          document.querySelector("#BookImageUrl1").value =""
          document.querySelector("#textArea1").value =""
 })

    </script>
    <script src="../js/convertDataObj.js"></script>
  </body>
</html>
